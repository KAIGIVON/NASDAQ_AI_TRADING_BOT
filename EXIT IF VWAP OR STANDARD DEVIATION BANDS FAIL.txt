//@version=5
indicator("×¡×’×™×¨×ª ×¢×¡×§×” â€“ ×›×©×œ ×¤×¨×™×¦×” ×¢×œ VWAP ×•×¢×œ STDEV1 ×”×¢×œ×™×•× ×” ×‘×œ×‘×“", overlay=true)

// ===== ×§×œ×˜×™× =====
devUp1 = input(1.33, title="×¡×˜×™×™×ª ×ª×§×Ÿ ×¢×œ×™×•× ×” 1")
devUp2 = input(1.96, title="×¡×˜×™×™×ª ×ª×§×Ÿ ×¢×œ×™×•× ×” 2")
devUp3 = input(2.61, title="×¡×˜×™×™×ª ×ª×§×Ÿ ×¢×œ×™×•× ×” 3")

// ===== ×—×™×©×•×‘ VWAP ×•×¡×˜×™×™×ª ×ª×§×Ÿ =====
newSession = ta.change(time("D"))
vwapsum   = 0.0
volumesum = 0.0
v2sum     = 0.0

vwapsum   := newSession ? hl2 * volume : nz(vwapsum[1]) + hl2 * volume
volumesum := newSession ? volume       : nz(volumesum[1]) + volume
v2sum     := newSession ? volume * hl2 * hl2 : nz(v2sum[1]) + volume * hl2 * hl2

vwap  = vwapsum / volumesum
stdev = math.sqrt(math.max(v2sum / volumesum - vwap * vwap, 0))

// ===== ×¨××•×ª ×¢×œ×™×•× ×•×ª ×‘×œ×‘×“ =====
vwapu0 = vwap
vwapu1 = vwap + stdev * devUp1
vwapu2 = vwap + stdev * devUp2
vwapu3 = vwap + stdev * devUp3

// ===== ×“×’×œ×™ ×¤×¨×™×¦×” =====
var bool wentAboveVWAP   = false
var bool wentAboveSTDEV1 = false

if newSession
    wentAboveVWAP   := false
    wentAboveSTDEV1 := false

// ×× ×¢×œ×™× ×• ××¢×œ VWAP / ××¢×œ VWAP+STDEV1 ×‘××”×œ×š ×”×™×•× (×›×•×œ×œ ×’××¤ ×¤×ª×™×—×”)
if close > vwap
    wentAboveVWAP := true
if close > vwapu1
    wentAboveSTDEV1 := true

// ===== ×ª× ××™ ×™×¦×™××” =====
exitVWAP   = wentAboveVWAP   and ta.crossunder(close, vwap)
// ×›×©×œ ×¤×¨×™×¦×” ×¨×§ ×¢×œ ×”×¡×˜×™×™×” ×”×¢×œ×™×•× ×” (××™×Ÿ ×©×™××•×© ×‘×ª×—×ª×•× ×”)
exitSTDEV1 = wentAboveSTDEV1 and ta.crossunder(close, vwapu1)

// ××¤×©×¨ ×œ×”×©××™×¨ OR ×× ××ª×” ×¨×•×¦×” ×œ×¦××ª ×¢×œ ×›×œ ××—×“ ××”×:
exit100 = exitVWAP or exitSTDEV1

// ===== ×¦×™×•×¨ =====
plot(vwapu0, title="VWAP",        color=color.rgb(255,255,255,100))
plot(vwapu1, title="VWAP+STDEV1", color=color.rgb(255,254,254,100))
plot(vwapu2, title="VWAP+STDEV2", color=color.rgb(255,255,255,100))
plot(vwapu3, title="VWAP+STDEV3", color=color.rgb(255,255,255,100))

// ===== ×”×ª×¨××•×ª =====
alertcondition(exitVWAP,   title="×™×¨×™×“×” ×—×•×–×¨×ª ××ª×—×ª ×œ-VWAP",       message="ğŸš¨ ×™×¦×™××” 100% â€“ ×›×©×œ ×¢×œ VWAP")
alertcondition(exitSTDEV1, title="×™×¨×™×“×” ××ª×—×ª ×œ-VWAP+STDEV1",      message="ğŸš¨ ×™×¦×™××” 100% â€“ ×›×©×œ ×¢×œ STDEV1 ×”×¢×œ×™×•× ×”")
alertcondition(exit100,    title="Exit ANY (VWAP or STDEV1 upper)", message="ğŸš¨ ×™×¦×™××” 100% â€“ ×›×©×œ ×¢×œ VWAP ××• STDEV1 ×”×¢×œ×™×•× ×”")

// ===== ×¡×™××•×Ÿ =====
plotshape(exitVWAP,   title="Exit on VWAP Fail",   location=location.belowbar, color=color.red,    style=shape.labelup, text=" ×™×¦×™××” VWAP ")
plotshape(exitSTDEV1, title="Exit on STDEV1 Fail", location=location.belowbar, color=color.orange, style=shape.labelup, text=" ×™×¦×™××” STDEV1 ")
plotshape(exit100,    title="Exit ANY",            location=location.belowbar, color=color.fuchsia, style=shape.triangledown, text=" 100% Exit ")
